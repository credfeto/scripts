version: "3"
 
services:
 
  nuget:
    image: loicsharma/baget:latest
    hostname: baget-nuget
    restart: unless-stopped
    stop_grace_period: 500s
    stop_signal: SIGINT
    ports:
      - 5555:80
    environment:
      - ApiKey=Upload
      - Storage__Type=FileSystem
      - Storage__Path=/var/baget/packages
      - Database__Type=Sqlite
      - Database__ConnectionString=Data Source=/var/baget/baget.db
      - Search__Type=Database
      - Mirror__Enabled=true
      - Mirror__PackageSource=https://api.nuget.org/v3/index.json
      - Mirror__PackageDownloadTimeoutSeconds=600
      - AllowPackageOverwrites=true
      - PackageDeletionBehavior=HardDelete
      - Logging__Console__LogLevel_Default=Information
    volumes:
      - /home/markr/docker/baget-data/nuget:/var/baget

  nuget-sync:
    image: loicsharma/baget:latest
    hostname: baget-nuget-sync
    command: import downloads
    restart: unless-stopped
    stop_grace_period: 500s
    stop_signal: SIGINT
    environment:
      - ApiKey=Upload
      - Storage__Type=FileSystem
      - Storage__Path=/var/baget/packages
      - Database__Type=Sqlite
      - Database__ConnectionString=Data Source=/var/baget/baget.db
      - Search__Type=Database
      - Mirror__Enabled=true
      - Mirror__PackageSource=https://api.nuget.org/v3/index.json
      - Mirror__PackageDownloadTimeoutSeconds=600
      - AllowPackageOverwrites=true
      - PackageDeletionBehavior=HardDelete
      - Logging__Console__LogLevel_Default=Information
    volumes:
      - /home/markr/docker/baget-data/nuget:/var/baget
    depends_on:
      nuget:
        condition: service_started

  funfair:
    image: loicsharma/baget:latest
    command: import downloads
    restart: unless-stopped
    stop_grace_period: 500s
    stop_signal: SIGINT
    ports:
      - 5556:80 
    environment:
      - ApiKey=Upload
      - Storage__Type=FileSystem
      - Storage__Path=/var/baget/packages
      - Database__Type=Sqlite
      - Database__ConnectionString=Data Source=/var/baget/baget.db
      - Search__Type=Database
      - Mirror__Enabled=true
      - Mirror__PackageSource=https://funfair.myget.org/F/internal/auth/071ea13d-90dd-4b3d-a2be-6133beba5d05/api/v3/index.json
      - Mirror__PackageDownloadTimeoutSeconds=600
      - AllowPackageOverwrites=true
      - PackageDeletionBehavior=HardDelete
      - Logging__Console__LogLevel_Default=Information
    volumes:
      - /home/markr/docker/baget-data/funfair:/var/baget

  funfair-sync:
    image: loicsharma/baget:latest
    hostname: baget-funfair-sync
    command: import downloads
    restart: unless-stopped
    stop_grace_period: 500s
    stop_signal: SIGINT
    environment:
      - ApiKey=Upload
      - Storage__Type=FileSystem
      - Storage__Path=/var/baget/packages
      - Database__Type=Sqlite
      - Database__ConnectionString=Data Source=/var/baget/baget.db
      - Search__Type=Database
      - Mirror__Enabled=true
      - Mirror__PackageSource=https://funfair.myget.org/F/internal/auth/071ea13d-90dd-4b3d-a2be-6133beba5d05/api/v3/index.json
      - Mirror__PackageDownloadTimeoutSeconds=600
      - AllowPackageOverwrites=true
      - PackageDeletionBehavior=HardDelete
      - Logging__Console__LogLevel_Default=Information
    volumes:
      - /home/markr/docker/baget-data/funfair:/var/baget
    depends_on:
      funfair:
        condition: service_started               

