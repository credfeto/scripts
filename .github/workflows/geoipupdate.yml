name: Perform Maxmind GEOIP Updates

on:
  schedule:
    - cron: "15 3 * * *"

jobs:
  update-geoip:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2.3.4
      with:
        fetch-depth: 0
        ref: ${{ github.head_ref }}
        token: ${{ secrets.SOURCE_PUSH_TOKEN }}
    - run: |
        echo AccountID ${{ secrets.MAXMIND_ACCOUNT_ID }} > GeoIP.conf
        echo LicenseKey ${{ secrets.MAXMIND_LICENSE_KEY }} >> GeoIP.conf
        echo EditionIDs GeoLite2-Country >> GeoIP.conf
    - run: sudo add-apt-repository ppa:maxmind/ppa
    - run: sudo apt update
    - run: sudo apt install geoipupdate
    - run: geoipupdate --config-file GeoIP.conf --database-directory geoip
    - uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: "[FF-368] - Updated GEOIP DB from MaxMind"
        file_pattern: "*.mmdb"
        commit_user_name: "fun-geoip[bot]"
        commit_user_email: "credfeto@users.noreply.github.com"
        commit_author: "fun-geoip[bot] <credfeto@users.noreply.github.com>"
        skip_dirty_check: false